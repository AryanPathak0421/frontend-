<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="./favicon.ico" sizes="any">
  <title>üé¨ BoxOfficePredictor+ | Logout</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    .logout-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 80vh;
      text-align: center;
      padding: 2rem;
    }

    .logout-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 20px;
      padding: 3rem;
      max-width: 500px;
      width: 100%;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }

    .logout-icon {
      font-size: 4rem;
      margin-bottom: 1.5rem;
      animation: fadeInScale 0.6s ease-out;
    }

    .logout-title {
      font-size: 2.5rem;
      font-weight: 700;
      color: #fff;
      margin-bottom: 1rem;
      animation: fadeInUp 0.8s ease-out 0.2s both;
    }

    .logout-message {
      font-size: 1.2rem;
      color: rgba(255, 255, 255, 0.8);
      margin-bottom: 2rem;
      line-height: 1.6;
      animation: fadeInUp 0.8s ease-out 0.4s both;
    }

    .logout-actions {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
      animation: fadeInUp 0.8s ease-out 0.6s both;
    }

    .logout-btn {
      padding: 0.75rem 2rem;
      border: none;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      min-width: 120px;
      justify-content: center;
    }

    .confirm-btn {
      background: linear-gradient(135deg, #ff6b6b, #ee5a52);
      color: white;
      box-shadow: 0 4px 15px rgba(238, 90, 82, 0.4);
    }

    .confirm-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(238, 90, 82, 0.6);
    }

    .cancel-btn {
      background: linear-gradient(135deg, #4ecdc4, #44a08d);
      color: white;
      box-shadow: 0 4px 15px rgba(78, 205, 196, 0.4);
    }

    .cancel-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(78, 205, 196, 0.6);
    }

    .processing {
      opacity: 0.7;
      pointer-events: none;
    }

    .processing::after {
      content: '';
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid transparent;
      border-top: 2px solid currentColor;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-left: 0.5rem;
    }

    .success-message {
      background: linear-gradient(135deg, #4ecdc4, #44a08d);
      color: white;
      padding: 1rem 2rem;
      border-radius: 12px;
      margin-bottom: 2rem;
      display: none;
      animation: slideInDown 0.5s ease-out;
    }

    .countdown {
      font-size: 1.1rem;
      color: #ffd93d;
      margin-top: 1rem;
      font-weight: 600;
      display: none;
    }

    @keyframes fadeInScale {
      from {
        opacity: 0;
        transform: scale(0.5);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideInDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    @media (max-width: 768px) {
      .logout-card {
        padding: 2rem;
        margin: 1rem;
      }
      
      .logout-title {
        font-size: 2rem;
      }
      
      .logout-actions {
        flex-direction: column;
        align-items: center;
      }
      
      .logout-btn {
        width: 100%;
        max-width: 200px;
      }
    }
  </style>
</head>
<body>
  <!-- Particles Background -->
  <div class="particles" id="particles"></div>

  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <div class="logo">üé¨ BoxOfficePredictor+</div>
      <nav class="nav-links">
        <a href="./auth.html" class="nav-link">Dashboard</a>
        <a href="./analytics.html" class="nav-link">Analytics</a>
        <a href="./trending.html" class="nav-link">Trending</a>
        <a href="./about.html" class="nav-link">About</a>
      </nav>
    </div>
  </header>

  <!-- Main Content -->
  <div class="main-container">
    <div class="logout-container">
      <div class="logout-card">
        <div class="logout-icon">üö™</div>
        
        <div class="success-message" id="successMessage">
          <strong>‚úÖ Logout Successful!</strong>
          <div>You have been successfully logged out.</div>
        </div>
        
        <h1 class="logout-title">Confirm Logout</h1>
        <p class="logout-message">
          Are you sure you want to logout from BoxOfficePredictor+? 
          You'll need to sign in again to access your dashboard and premium features.
        </p>
        
        <div class="logout-actions" id="logoutActions">
          <button class="logout-btn confirm-btn" id="confirmLogout">
            <span>üö™</span>
            Yes, Logout
          </button>
          <a href="./auth.html" class="logout-btn cancel-btn">
            <span>‚Ü©Ô∏è</span>
            Cancel
          </a>
        </div>
        
        <div class="countdown" id="countdown">
          Redirecting to home page in <span id="countdownNumber">3</span> seconds...
        </div>
      </div>
    </div>
  </div>

  <script>
    // Create particles background
    function createParticles() {
      const particlesContainer = document.getElementById('particles');
      if (!particlesContainer) return;
      
      const numberOfParticles = 50;

      for (let i = 0; i < numberOfParticles; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        
        const size = Math.random() * 4 + 2;
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        particle.style.left = `${Math.random() * 100}%`;
        particle.style.top = `${Math.random() * 100}%`;
        particle.style.animationDuration = `${Math.random() * 20 + 10}s`;
        particle.style.animationDelay = `${Math.random() * 20}s`;
        
        particlesContainer.appendChild(particle);
      }
    }

    // Logout functionality
    async function performLogout() {
      const confirmBtn = document.getElementById('confirmLogout');
      const logoutActions = document.getElementById('logoutActions');
      const successMessage = document.getElementById('successMessage');
      const countdown = document.getElementById('countdown');
      
      try {
        // Show processing state
        confirmBtn.classList.add('processing');
        confirmBtn.textContent = 'Logging out...';
        
        // Get token from storage
        const token = sessionStorage.getItem('token') || 
                     localStorage.getItem('authToken') || 
                     localStorage.getItem('token');
        
        if (token) {
          // Call logout API
          try {
            await fetch('https://boxofficepredictor-backend.onrender.com/api/auth/logout', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
              },
              credentials: 'include'
            });
          } catch (apiError) {
            console.log('Logout API call failed, but continuing with local logout:', apiError);
          }
        }
        
        // Clear all authentication data
        sessionStorage.clear();
        localStorage.removeItem('authToken');
        localStorage.removeItem('token');
        localStorage.removeItem('user');
        localStorage.removeItem('userData');
        
        // Show success state
        logoutActions.style.display = 'none';
        successMessage.style.display = 'block';
        countdown.style.display = 'block';
        
        // Start countdown
        let countdownValue = 3;
        const countdownElement = document.getElementById('countdownNumber');
        
        const countdownInterval = setInterval(() => {
          countdownValue--;
          countdownElement.textContent = countdownValue;
          
          if (countdownValue <= 0) {
            clearInterval(countdownInterval);
            window.location.href = './index.html';
          }
        }, 1000);
        
      } catch (error) {
        console.error('Logout error:', error);
        
        // Even if there's an error, clear local data and redirect
        sessionStorage.clear();
        localStorage.removeItem('authToken');
        localStorage.removeItem('token');
        localStorage.removeItem('user');
        localStorage.removeItem('userData');
        
        alert('Logout completed. Redirecting to home page...');
        setTimeout(() => {
          window.location.href = './index.html';
        }, 1000);
      }
    }

    // Check if user is actually logged in
    function checkAuthStatus() {
      const token = sessionStorage.getItem('token') || 
                   localStorage.getItem('authToken') || 
                   localStorage.getItem('token');
      
      if (!token) {
        // User is not logged in, redirect to index
        window.location.href = './index.html';
        return false;
      }
      
      return true;
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      // Create particles
      createParticles();
      
      // Check if user is logged in
      if (!checkAuthStatus()) {
        return;
      }
      
      // Add logout confirmation handler
      const confirmBtn = document.getElementById('confirmLogout');
      if (confirmBtn) {
        confirmBtn.addEventListener('click', performLogout);
      }
      
      // Handle keyboard shortcuts
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
          performLogout();
        } else if (e.key === 'Escape') {
          window.location.href = './auth.html';
        }
      });
    });

    // Handle page visibility to prevent unauthorized access
    document.addEventListener('visibilitychange', function() {
      if (!document.hidden) {
        checkAuthStatus();
      }
    });

    // Auto-logout if token expires during page visit
    setInterval(checkAuthStatus, 30000); // Check every 30 seconds\
    if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js")
    .then(reg => console.log("Service Worker registered:", reg))
    .catch(err => console.log("Service Worker registration failed:", err));
}

  </script>
</body>
</html>